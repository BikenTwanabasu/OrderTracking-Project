@model IEnumerable<CollegeProject.Models.AgentTaskModel>
@{
    ViewData["Title"] = "GetAdminsPresentList";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"] – Gaubesi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" />

    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css" />

    <!-- Page CSS -->
	<link href="~/css/adminpresentlist.css" rel="stylesheet" />
</head>
<body>
    <div class="MainDiv">
        <!-- Navbar -->
        <nav class="nav">
            <div class="logo">
                <img src="https://gaaubesi.com/static/assets/images/LOGO.gif" alt="Gaubesi Logo" />
            </div>
            <ul class="nav-links">
                <li><a asp-controller="Admin" asp-action="AdminDashboard">Home</a></li>
                <li><a asp-controller="Admin" asp-action="GetAdminsHistoryList">Past Deliveries</a></li>
                <li><a asp-controller="Admin" asp-action="GetAdminsPresentList" class="active">Live Deliveries</a></li>
                <li><a asp-controller="Admin" asp-action="AgentRegistrationApprovalRequest">Agent Approval</a></li>
                <li><a asp-controller="Admin" asp-action="VendorRegistrationApprovalRequest">Vendor Approval</a></li>
                <li><a asp-controller="Log" asp-action="Logout">Logout</a></li>
            </ul>
        </nav>

        <!-- Page Title -->
        <h1 style="text-align:center; margin-top:2rem;">GetAdminsPresentList</h1>

        <!-- Table -->
        <div style="width:87%; height:60vh; margin: 1rem auto;">
            <table class="table table-bordered table-striped table-hover mb-2" id="table1">
                <thead>
                    <tr>
                        <th>OrderId</th>
                        <th>CompanyID</th>
                        <th>VendorName</th>
                        <th>VendorPhone</th>
                        <th>CustomerId</th>
                        <th>CustomerName</th>
                        <th>CustomerAddress</th>
                        <th>CustomerPhone</th>
                        <th>CreatedDate</th>
                        <th>ReceiverAgentId</th>
                        <th>ReceiverAgentName</th>
                        <th>ReceiverAgentPhone</th>
                        <th>DeliveredDate</th>
                        <th>DeliveryAgentId</th>
                        <th>DeliveryAgentName</th>
                        <th>DeliveryAgentPhone</th>
                        <th>Delivery Charge</th>
                        <th>Total Amount</th>
                        <th>DeliveryStatus</th>
                        <th>Extras</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

        <!-- Status Confirmation Modal -->
        <div class="modal" id="Modal" data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Status Update</h5>
                    </div>
                    <div class="modal-body" id="DetailsBody">
                        <p>Are you sure want to update the status?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="ConfirmButton">Confirm</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal" id="DeleteModal" data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Status Update</h5>
                    </div>
                    <div class="modal-body" id="DetailsBody">
                        <p>Are you sure want to Delete the Order?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="DeleteConfirmButton">Confirm</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Order Modal -->
        <div class="modal" id="EditModal" data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Status Update</h5>
                    </div>
                    <div class="modal-body" id="EditDetailsBody">
                        <table class="table table-bordered" id="EditTable">
                            <tr><th>Order ID</th><td><input type="text" id="OrderId" class="form-control" readonly /></td></tr>
                            <tr><th>Delivered Date</th><td><input type="text" id="DeliveredDate" class="form-control" /></td></tr>
                            <tr><th>Customer Address</th><td><input type="text" id="CustomerAddress" class="form-control" /></td></tr>
                            <tr><th>Amount</th><td><input type="text" id="Amount" class="form-control" /></td></tr>
                            <tr><th>Delivery Charge</th><td><input type="text" id="DeliveryCharge" class="form-control" /></td></tr>
                            <tr><th>Created Date</th><td><input type="text" id="CreatedDate" class="form-control" /></td></tr>
                            <tr>
                                <th>Delivery Status</th>
                                <td>
                                    <select id="DeliveryStatus" class="form-control">
                                        <option value="Order Created">Order Created</option>
                                        <option value="Picked up by Agent">Picked up by Agent</option>
                                        <option value="Arrived at Warehouse">Arrived at Warehouse</option>
                                        <option value="Dispatched for Delivery">Dispatched for Delivery</option>
                                        <option value="Successfully Delivered">Successfully Delivered</option>
                                    </select>
                                </td>
                            </tr>
                            <tr><th>Customer Phone</th><td><input type="text" id="CustomerPhone" class="form-control" /></td></tr>
                            <tr><th>Vendor Phone</th><td><input type="text" id="VendorPhone" class="form-control" /></td></tr>
                        </table>
                        <div>
                            <input type="button" class="btn btn-primary" onclick="UpdateDataByAdmin()" value="Update Order" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- /.MainDiv -->
    <!-- Scripts -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>

    <script>
        $(document).ready(function(){
            GetPresentList();
        });

        function GetPresentList(){
            $.ajax({
                url: '@Url.Action("GetAdminsPresentJSON", "Admin")',
                type:'Get',
                dataType:'Json',
                success:function(response){
                    if(response!=null){
                        var row='';
                        for(var i=0;i<response.length;i++){
                            var disableButton = (response[i].deliveryStatus==='Arrived at Warehouse' || response[i].deliveryStatus==='Picked up by Agent')
                                ? '' : 'disabled';
                            row += `
                                <tr>
                                  <td>${response[i].orderId}</td>
                                  <td>${response[i].companyID}</td>
                                  <td>${response[i].vendorName}</td>
                                  <td>${response[i].vendorPhone}</td>
                                  <td>${response[i].customerId}</td>
                                  <td>${response[i].customerName}</td>
                                  <td>${response[i].customerAddress}</td>
                                  <td>${response[i].customerPhone}</td>
                                  <td>${response[i].createdDate}</td>
                                  <td>${response[i].receiverAgentId}</td>
                                  <td>${response[i].receiverAgentName}</td>
                                  <td>${response[i].receiverAgentPhone}</td>
                                  <td>${response[i].deliveredDate}</td>
                                  <td>${response[i].deliveryAgentId}</td>
                                  <td>${response[i].deliveryAgentName}</td>
                                  <td>${response[i].deliveryAgentPhone}</td>
                                  <td>${response[i].deliveryCharge}</td>
                                  <td>${response[i].totalAmount}</td>
                                  <td>
                                    <input
                                      type="button"
                                      value="${response[i].deliveryStatus}"
                                      id="Status${response[i].orderId}"
                                      ${disableButton}
                                      onclick="ShowModal(${response[i].orderId})"
                                      class="btn btn-success"
                                    />
                                  </td>
                                  <td>
                                    <div class="Btns" style="display:flex; gap:0.5rem;">
                                      <input
                                        type="button"
                                        class="btn btn-warning"
                                        value="Edit"
                                        onclick="EditOrderModal(${response[i].orderId})"
                                      />
                                      <input
                                        type="button"
                                        class="btn btn-danger"
                                        value="Delete"
                                        onclick="DeleteOrderModal(${response[i].orderId})"
                                      />
                                    </div>
                                  </td>
                                </tr>`;
                        }
                        $("#table1 tbody").html(row);
                        $("#table1").DataTable({
                            scrollX: true,
                            paging: false,
                            scrollCollapse: true,
                            scrollY: '60vh'
                        });
                    }
                },
                error:function(){
                    alert("Error Occured");
                }
            });
        }

        // All of your existing modal, update, delete, show, etc. functions go here unchanged...
    </script>
</body>
</html>
